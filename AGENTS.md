# Repository Guidelines

This document provides guidelines for AI coding agents working in this repository.
Blocky UI is a Next.js dashboard for the [Blocky DNS proxy](https://github.com/0xERR0R/blocky).

## Project Structure

```
src/
├── app/                    # Next.js App Router
│   ├── api/trpc/          # tRPC API route handler
│   ├── layout.tsx         # Root layout
│   └── page.tsx           # Home page
├── components/
│   ├── ui/                # shadcn/ui components (generated, do not edit)
│   └── dashboard/         # App-specific components
├── hooks/                 # Custom React hooks (use-*.ts)
├── lib/                   # Utilities (utils.ts, constants.ts)
├── mocks/                 # MSW handlers for API mocking
├── server/
│   ├── api/routers/       # tRPC routers
│   └── logs/              # Query log providers (mysql, csv, demo)
├── styles/globals.css     # Global styles (Tailwind v4)
├── trpc/                  # tRPC client setup
└── env.js                 # Environment validation (@t3-oss/env-nextjs)
```

## Build, Lint, and Development Commands

```bash
pnpm run dev                   # Start dev server (Next.js + Turbo)
pnpm run build                 # Production build
pnpm run preview               # Build and serve locally
pnpm run start                 # Serve an existing build
pnpm run lint                  # Run ESLint
pnpm run lint:fix              # Run ESLint with auto-fix
pnpm run format:check          # Check Prettier formatting
pnpm run format:write          # Auto-format with Prettier
pnpm run typecheck             # TypeScript type checking
pnpm run ci                    # Run all checks (lint + format + typecheck)
pnpm run db:generate           # Generate Drizzle migrations
pnpm run db:migrate            # Run migrations
pnpm run db:push               # Push schema changes
pnpm run db:studio             # Open Drizzle Studio
```

## Testing Guidelines

No unit test runner is currently configured. After changing code, always validate your changes with `pnpm run ci` - Runs lint, format check, and typecheck

Future tests should be colocated as `*.test.ts(x)`.

## Code Style Guidelines

### TypeScript

- Strict mode enabled with `noUncheckedIndexedAccess`
- Use `type` imports: `import { type Foo } from "bar"`
- Prefix unused parameters with underscore: `(_unused) => {}`
- Never use `any`; prefer `unknown` when type is truly unknown
- Do not use non-null assertions (`!`) or type casting to bypass errors

### Imports

- Use the `~/` path alias for all src imports: `import { cn } from "~/lib/utils"`
- Prefer type imports: `import { type ComponentProps } from "react"`
- Never import directly from `clsx`; use `cn` from `~/lib/utils` instead

### React Components

- File naming: `PascalCase.tsx` for components
- Add `"use client"` directive only when needed (hooks, browser APIs, event handlers)
- Destructure props in function signature

```tsx
// Good
export function MyComponent({ title, onClick }: MyComponentProps) {
  return <button onClick={onClick}>{title}</button>;
}

// Avoid
export const MyComponent: React.FC<MyComponentProps> = (props) => {
  return <button onClick={props.onClick}>{props.title}</button>;
};
```

### Hooks

- File naming: `use-*.ts` (kebab-case with `use-` prefix)
- Custom hooks should be in `src/hooks/`

### Styling

- Use Tailwind CSS classes exclusively
- Use `cn()` for conditional class merging
- Tailwind classes are auto-sorted by Prettier plugin
- Tailwind v4 is in use (CSS-based config in `globals.css`)

### tRPC

- Routers go in `src/server/api/routers/`
- Use `publicProcedure` for endpoints
- Validate inputs with Zod schemas
- Access client via `api` from `~/trpc/react`

```tsx
const { data, isLoading } = api.blocky.blockingStatus.useQuery();
const mutation = api.blocky.blockingEnable.useMutation({
  onSuccess: () => void utils.blocky.blockingStatus.invalidate(),
});
```

### Error Handling

- Use try/catch for async operations that may fail
- Provide user-friendly error messages
- Use `toast` from `sonner` for user notifications

### shadcn/ui Components

Components in `src/components/ui/` are generated by shadcn CLI. Ask for permission first before editing.
If a component exists in shadcn, add it instead of creating a new component. To add new shadcn components: `pnpm dlx shadcn@latest add <component-name>`

## Environment Variables

Validated via `@t3-oss/env-nextjs` in `src/env.js`.

Never commit secrets. Use `.env` for local development.

## Formatting & Linting Rules

- 2-space indentation, LF line endings
- No semicolons (handled by Prettier defaults)
- Drizzle: Always use `where` clause with `delete` and `update`
- Report unused ESLint disable directives

## Git Workflow

CI runs on all PRs to main:

1. Install dependencies with pnpm
2. Run `pnpm run ci` (lint + format + typecheck)

Ensure `pnpm run ci` passes before pushing.
